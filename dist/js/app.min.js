var app=angular.module("AlcooTestApp",["ui.router","firebase"]);app.config(function($stateProvider,$urlRouterProvider){$stateProvider.state("home",{url:"/",templateUrl:"views/home.html",controller:"homeCtrl",controllerAs:"home"}).state("tableau",{url:"/tableau",templateUrl:"views/tableau.html",controller:"tableauCtrl",controllerAs:"tableau"}).state("questions",{url:"/questions",templateUrl:"views/questions.html",controller:"questionsCtrl",controllerAs:"questions"}).state("resultat",{url:"/resultat",templateUrl:"views/resultat.html",controller:"resultatCtrl",controllerAs:"resultat"}),$urlRouterProvider.otherwise("/")}),app.run(function($rootScope,$state){$rootScope.$on("$stateChangeStart",function(event,toState){$rootScope.connecte||("questions"===toState.name||"resultat"===toState.name)&&(event.preventDefault(),$state.go("home")),angular.isUndefined($rootScope.score)&&"resultat"===toState.name&&(event.preventDefault(),$state.go("home"))})});var ref=new Firebase("https://alcootest-angular.firebaseio.com/");app.factory("AuthFactory",function($firebaseAuth){return $firebaseAuth(ref)}),app.factory("UsersFactory",function($firebaseArray){return $firebaseArray(ref)}),app.controller("homeCtrl",function(AuthFactory,$rootScope,UsersFactory){var home=this;home.users=UsersFactory,home.userData=null,$rootScope.connecte=!1,home.box=!1,home.signWithGoogle=function(){AuthFactory.$authWithOAuthPopup("google").then(function(authData){console.log("Connexion Réussie ! ",authData),home.userData=authData.google})["catch"](function(error){console.log("Connexion ratée... !! ",error),home.authError=error})},AuthFactory.$onAuth(function(authData){authData?($rootScope.userName=authData.google.displayName,$rootScope.connecte=!0):home.userData=null}),home.signOut=function(){AuthFactory.$unauth(),$rootScope.connecte=!1,delete $rootScope.userName,delete $rootScope.score}}),app.factory("quizzFactory",function(){return{nbQuestion:5,timer:7e3,score:1,questions:[{question:"Si je suis muet, aveugle et sourd, combien de sens me reste-t-il ?",reponses:["2","5","3","un seul","c'est quoi un sens ?"],answer:"3"},{question:"Dans une course à pied je double le 2ème, je suis donc ?",reponses:["2ème","1er","Avant dernier","j'ai gagné !","trop dur de courir"],answer:"2ème"},{question:"Le père de mon oncle à un petit fils. Donc c'est mon ?",reponses:["Grand Père","Fils","Neveu","Cousin","Frère"],answer:"Cousin"},{question:"La souris mange le fromage, le chat mange la souris. Qui reste-t-il ?",reponses:["le fromage","la table","des dents","le chat","le chien"],answer:"le chat"},{question:"Calculez 3+78370",reponses:["3","78373","WTF","Zéro","je sais pas compter !"],answer:"78373"},{question:"Quel est la couleur du cheval blanc d'henri 4 ?",reponses:["jaune","rouge","vert","bleu","blanc"],answer:"blanc"},{question:"Certains mois ont 31 jours. Combien en ont 28 ?",reponses:["Bah 1 seul !!","16","6","12","7"],answer:"12"},{question:"J'ai 48 ans mais j'ai fêté mon anniversaire que 12 fois, pourquoi ?",reponses:["car t'as pas d'amis !","je suis né un 29 février","tes parents t'aimes pas","hein ?!","je suis né un vendredi 13"],answer:"je suis né un 29 février"},{question:"Qu' est ce qu'y peut traverser une fenêtre qui est fermée ?",reponses:["Chuck Norris","l'homme invisble","le soleil","le rideau","OSEF !"],answer:"le soleil"},{question:"Un fermier à 17 vaches, elles meurent toutes sauf 9. Combien en reste-il ?",reponses:["9","8","17-9","tout un champs","Aucune ce sont des vaches folles !"],answer:"9"}]}}),app.controller("questionsCtrl",function(quizzFactory,$interval,$rootScope,$state){var quizz=this,iquestion=[];quizz.userName=$rootScope.userName,quizz.textSubmit="Question suivante >>",quizz.timer=quizzFactory.timer,quizz.progress=100,quizz.setTimer=function(){quizz.over=!1,quizz.temps=$interval(function(){quizz.timer>0?(quizz.timer-=1e3/60,quizz.progress=quizz.timer*(100/7e3),quizz.duree=Math.round(quizz.timer/1e3)):(quizz.rep=!0,quizz.over=!0,$interval.cancel(quizz.temps))},1e3/60)},quizz.getScore=function(index){0!=quizz.rep&&(quizz.rep===quizzFactory.questions[index].answer?(quizz.progress<=50&&(quizz.score+=1),quizz.progress>50&&(quizz.score+=2),0==quizz.progress&&(quizz.score-=2)):quizz.score-=2),$rootScope.score=quizz.score};var nbTotQuestion=quizzFactory.questions.length,nbQuestion=quizzFactory.nbQuestion;if(nbQuestion>nbTotQuestion)var nbQuestion=nbTotQuestion;quizz.numQ=1,quizz.rep=!1,quizz.indexQ=Math.floor(Math.random()*nbTotQuestion),iquestion.push(quizz.indexQ);var q=quizzFactory.questions[quizz.indexQ];quizz.score=quizzFactory.score,quizz.getQuestion=q.question,quizz.getReponses=q.reponses,quizz.setTimer(),quizz.nextQuestion=function(index){if(quizz.getScore(index),quizz.rep=!1,quizz.temps=$interval.cancel(quizz.temps),quizz.timer=quizzFactory.timer,quizz.progress=100,quizz.numQ<=nbQuestion){for(quizz.setTimer(),quizz.numQ++,quizz.indexQ=Math.floor(Math.random()*nbTotQuestion);-1!==iquestion.indexOf(quizz.indexQ);)quizz.indexQ=Math.floor(Math.random()*nbTotQuestion);iquestion.push(quizz.indexQ);var qN=quizzFactory.questions[quizz.indexQ];quizz.getQuestion=qN.question,quizz.getReponses=qN.reponses,quizz.numQ==nbQuestion&&(quizz.textSubmit="Voir le résultat...")}quizz.numQ===nbQuestion+1&&(quizz.getScore(index),$state.go("resultat"))}}),app.controller("resultatCtrl",function($rootScope,$state,UsersFactory,AuthFactory){var resultat=this;resultat.users=UsersFactory,resultat.score=$rootScope.score,resultat.userName=$rootScope.userName,resultat.ok=!1,resultat.ko=!1,resultat.score>4&&(resultat.ok=!0,resultat.message="James Bond peut aller se rhabiller, Bonne route !"),resultat.score>=0&&resultat.score<=4&&(resultat.ok=!0,resultat.message="Vous semblez un peu stressé. Détendez vous, tout vas bien ! Vous pouvez y aller, et surtout roulez sécure."),resultat.score<0&&resultat.score>=-2&&(resultat.ko=!0,resultat.message="Avec des réponses pareilles, mieux vaut être prudent ! Patientez encore avant de reprendre la route"),resultat.score<-2&&(resultat.ko=!0,resultat.message="Bon et bien le temps est venu d'aller dissiper cet alcool !!! Oubliez la voiture et laissez vos clés à vos hotes..."),resultat.users.$add({user:$rootScope.userName,score:$rootScope.score}),resultat.signOut=function(){AuthFactory.$unauth(),$rootScope.connecte=!1,delete $rootScope.userName,delete $rootScope.score,$state.go("home")}}),app.controller("tableauCtrl",function($rootScope,$scope,$filter,UsersFactory){var tableau=this;tableau.users=UsersFactory;var orderBy=$filter("orderBy"),reverse=!1;tableau.order=function(crit){reverse=reverse?!reverse:!0,tableau.users=orderBy(tableau.users,crit,reverse)}});